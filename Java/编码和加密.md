# 编码和加密

## 非对称加密

非对称加密需要两个密钥：publicKey 和 privateKey, 其中 publicKey 和 privateKey 是一对, 如果使用 publicKey 对数据进行加密，只有对应 privateKey 才能够解密。 因为加密和解密使用的是两个不同的密钥，所以这种加密算法叫做非对称加密算法

### 信息交换流程

用户 A 生成一对密钥，并将密钥的 publicKey 公开，要向 A 发送信息的用户 B 需要使用 A 的 publicKey 对敏感信息进行加密后发送给用户 A, A 用户接收到信息后使用 A 的 privateKey 进行解密

如果用户 A 要回复用户 B，操作过程则刚好相反。A 需要使用 B 的 publicKey 对信息进行加密后发送给 B，B 接收到信息后再使用 B 的 privateKey 对加密信息进行解密

A 可以使用 A 的 privateKey 对信息进行签名之后发送给 B, B 在接收到 A 发送过来的数据时，再使用 A 的公钥对数据进行验签

### 特点

- **用 privateKey 加密的数据只能够用 publicKey 进行解密，用 publicKey 加密的数据只能够使用 privateKey 进行解密**

- 非对称加密体系不要求通信双方事先传递密钥或有任何约定就能完成保密通信，并且密钥管理便，可实现防止假冒和抵赖，因此，更适合网络通信中的保密通信要求。
- 算法强度复杂、安全性依赖于算法与密钥
- 由于加密算法复杂，而使得加密解密速度没有对称加密解密的速度快

### 常见的非对称加密算法

| 算法     | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| RSA 算法 | 1) 是目前最有影响力的 **公钥加密算法**，并且被普遍认为是目前 **最优秀的公钥方案** 之一。`RSA` 是第一个能同时用于 **加密** 和 **数字签名** 的算法，它能够 **抵抗** 到目前为止已知的 **所有密码攻击**，已被 `ISO` 推荐为公钥数据加密标准<br />2)`RSA` **加密算法** 基于一个十分简单的数论事实：将两个大 **素数** 相乘十分容易，但想要对其乘积进行 **因式分解** 却极其困难，因此可以将 **乘积** 公开作为 **加密密钥**。 |
| ECC 算法 | 使用的密钥比其他算法使用的密钥要小                           |

## 对称加密

对称加密只得是加密和解密使用的相同的密钥

### 信息交换流程

1. 用户 A 需要将信息通过密钥 C 和加密算法进行加密之后，将加密后的密文发送给用户 B

2. 用户 B 接收到用户 A 发送的密文之后使用相同的密钥 C 和加密算法的逆算法对密文进行解密
3. 用户 B 要向用户 A 发送信息和用户 A 向用户 B 发送信息的操作一样

### 特点

- 通信的双方在通信之前必须事先商定一个密钥
- 加密密钥和解密密钥能够互相推算出来，但大多数的对称加密算法是加密密钥和解密密钥是相同的
- 对称算法的安全性依赖于密钥，泄漏密钥就意味着任何人都可以对他们发送或接收的消息解密，所以密钥的保密性对通信的安全性至关重要
- 每对用户进行通信都需要协商一个密钥，因此通信双方的密钥数量急剧增加,密钥的管理对用户来说是一种负担
- 对称加密算法能够提供加密和认证功能但是缺乏签名功能，使得使用范围有所缩小

### 常见的对称加密算法

| 算法 | 描述                                                         |
| ---- | ------------------------------------------------------------ |
| AES  | 1) `AES` 加密算法是密码学中的 **高级加密标准**，该加密算法采用 **对称分组密码体制**，密钥长度的最少支持为 `128` 位、 `192` 位、`256` 位，分组长度 `128` 位，算法应易于各种硬件和软件实现。这种加密算法是美国联邦政府采用的 **区块加密标准**<br />2) `AES` 本身就是为了取代 `DES` 的，`AES` 具有更好的 **安全性**、**效率** 和 **灵活性**。 |
| DES  | 1) `DES` 加密算法是一种 **分组密码**，以 `64` 位为 **分组对数据** 加密，它的 **密钥长度** 是 `56` 位，**加密解密** 用 **同一算法**。<br />2) `DES` 加密算法是对 **密钥** 进行保密，而 **公开算法**，包括加密和解密算法。因此，只有掌握了和发送方 **相同密钥** 的人才能解读由 `DES`加密算法加密的密文数据 |
| 3DES | 是基于 `DES` 的 **对称算法**，对 **一块数据** 用 **三个不同的密钥** 进行 **三次加密**，**强度更高**。 |

## 数字摘要

**数字摘要的作用是将任意长度的数据变成固定长度的短数据**,它类似于一个自变量是数据的函数，也就是 Hash 函数。数字摘要采用单向 Hash函数将需要加密的明文“摘要”成一串固定长度（128位）的密文，这一串密文又称为数字指纹，它有固定的长度，而且**不同的明文摘要成密文，其结果总是不同的，而同样的明文其摘要必定一致**。

一般来说，安全 Hash 标准的输出长度为 160 位，这样才能保证它足够的安全,常见的摘要算法有 **SHA(Security Hash Algorithm)** 和 **MD5(MD Standards For Message Digest)**

一般来说，非对称加密是用来处理短消息的，而相对于较长的消息则显得有些吃力。当然，可以将长的消息分成若干小段，然后再分别签名。不过，这样做非常麻烦，而且会带来数据完整性的问题。**比较合理的做法是在数字签名前对消息先进行数字摘要**。

#### 基本原理

1. 发送方 A 将需要发送的数据使用 SHA 或者 MD5 算法形成一个 128 bit的数字摘要 B
2. A 再将得到的数字摘要使用 privateKey 进行加密, 这样就得到了数字签名
3. 将数字签名和原文发送给接受方
4. 接受方在收到数据后，将原文使用相同的算法形成数字摘要 C，将数字签名使用 A 的 publicKey 进行解密得到数字摘要 C
5. 比较 B 与 C 是否相同，如果相同，则表示数据没有被篡改，否则，收到的数据不正确

## 数字签名

数字签名又称为公钥数字签名，是只有信息的发送方才可以产生的别人无法伪造的一串数字,这段数字串同时也是对信息的发送者发送信息真实性的一个有效证明。一套数字签名通常定义**两种互补的运算**，一个用于签名，另一个用于验证, 其中私钥用于签名，公钥用于验证。数字签名是非对称密钥加密技术与数字摘要技术的应用。

### 特点

每个人都有一对密钥，私钥和密钥。签名的时候用私钥，验证签名的时候用公钥。 虽然公钥是公开的，但是不知道该公钥对应的私钥的持有者是谁，因此任何人都可以落款声称她/他就是你，因此公钥必须向接受者信任的人(身份认证机构)来注册。注册后身份认证机构给你发一张数字证书。对文件签名后，你把此数字证书连同文件及签名一起发给接受者，接受者向身份认证机构求证是否真地是用你的密钥签发的文件。数字证书的目的就是确保发送方使用的公钥是其想传递消息的接受方持有的公钥,认证过程如下

![img](https://img.halfrost.com/Blog/ArticleImage/105_7_.png)

## Base64 和 Base64Url 编码

### Base64 编码

基本的 ASCII 字符集共有 128 个字符，其中有 95 个**可打印字符**，包括常用的字母、数字、标点符号等，另外还有 33 个控制字符。标准 ASCII 码使用 7 个二进位对字符进行编码，对应的 ISO 标准为 ISO646 标准。

因为二进制数据中含有很多无法直接打印和显示的数据,一般的文本处理软件无法直接处理二进制文件，因此需要一种将二进制数据转换成字符串数据的方法，而 Base64 编码就是一种常用的二进制编码。

Base64编码是一种用 64 个**可打印字符**来表示任意二进制数据的编码。这 64 个字符从 0 重新开始编号，每一个编号对应一个字符，构造了一张新的码表，Base64 编码的编码过程如下：

首先将二进制数据分成每三个字节一组：$ 3 \times 8 = 24 \space bit$，而 $ 64 = 2 ^ 6$, 再将这三个字节分成 4 个部分，每个部分 6 bit，然后去查找码表，每个部分会对应一个字符。这样就将二进制数据转换成了字符数据。这种编码是将 3 个字节的二进制数据转换成 4 个字节的字符数据，因此编码后的长度增加 33%

如果要编码的二进制数据不是 3 的倍数，最后会剩下 1 个或 2 个字节怎么办？Base64 用 `\x00` 字节在末尾补足后，再在编码的末尾加上1 个或 2 个 `=` 号，表示补了多少字节，解码的时候，会自动去掉。

Base64 是一种任意二进制到文本字符串的编码方法，常用于在 URL、Cookie、网页中传输少量二进制数据。例如，URL 中只能够显示 ASCII 字符，无法显示中文字符，因此如果需要在 URL 拼接中文字符，需要将中文字符对应的二进制数据转换成 ASCII 字符才可以正确的拼接在 URL 中。

### Base64Url 编码

标准的 Base64 编码后的字符并不适合直接在放在 URL 中，因为 URL 编码器会把标准 Base64 中的 `/` 和 `+` 字符变为形如 `%XX` 的形式，而这些 `%` 号在存入数据库时还需要再进行转换，因为ANSI SQL中已将 `%` 号用作通配符

为了解决此问题，可采用一种用于 URL 的改进 Base64 编码。它不在末尾填充 `=` 号，并将标准 Base64 中的 `+` 和 `/` 分别改成了 `*` 和 `-`，这样就免去了在 URL 编解码和数据库存储时所要作的转换，避免了编码信息长度在此过程中的增加，并统一了数据库、表单等处对象标识符的格式。

## 数据摘要算法

数据摘要算法可以将数据转化成固定长度的字符串,无论输入数据多长，都有固定长度的输出

| 算法 | 描述                                                |
| ---- | --------------------------------------------------- |
| MD5  | 使用哈希函数产生摘要，不可逆                        |
| SHA  | SHA 比 MD5 更安全, 但速度比 MD5 慢，不可逆          |
| HMAC | 该算法将一个密钥和数据作为输入，输出消息摘要,不可逆 |


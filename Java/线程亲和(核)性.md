# 什么是线程亲核性？

所谓的线程亲核性(Thread Affinity)就是将线程与某个指定的 CPU 核心进行绑定。例如当线程 A 与 CPU 的核心 B 建立绑定关系之后，线程 A 需要执行的任务都会在核心 B 中完成，不会被调度到 CPU 其他的核心中去执行。

使用线程绑定技术可以减少操作系统调度过程中造成的抖动以及高速缓存失效的问题。

# 亲核性设置原理

底层是通过 bitmask 来设置，线程可在哪些核心上执行是通过二进制形式的 bitmask 来判断，bit 位为 1，则表示可在对应的核心上运行。核心编号从 0 开始编号。例如：

- bitmask 为 `01000000` 表示线程可以在核心 6 上运行
- bitmask 为 `01000001` 表示线程可以在核心 0，6 上运行
- bitmask 为 `10101010` 表示线程可以在核心 1，3，5，7 上运行

Mask 为一个 DWORD 类型，在 64 位机器上就是 64 位长度，8 字节，相当于 java 的 long 类型，所以这里有个缺陷，当 cpu 核超过 64 个的时候，也就超过了 64 bit(8字节)能够表示的长度，就无法使用这个函数进行线程亲和的设置了。可以用另一个 `SetThreadGroupAffinity` 函数解决，它使用处理器组解决了这个问题（目前 Java-Thread-Affinity 框架还不支持 64 核心以上的，可以自己利用这个方式修改一下）

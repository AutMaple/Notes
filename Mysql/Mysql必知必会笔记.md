# 常用命令

| 命令                                                | 描述                      |
| --------------------------------------------------- | ------------------------- |
| `show databases`                                    | 显示所有的数据库          |
| `show columns from <table>` 或者 `describe <table>` | 显示名为 table 表的列信息 |
| `show status`                                       | 展示服务器的状态          |
| `show create <database>`                            | 展示创建数据库时的信息    |
| `show grants`                                       | 展示授权信息              |
| `show errors`                                       | 展示服务器的错误信息      |
| `show warnings`                                     | 展示服务器的警告信息      |
| `help show`                                         | 查看 show 命令的使用方法  |
|                                                     |                           |
|                                                     |                           |

# Select 命令

## distinct 关键字

distinct 关键字必须放在所有列名的前面，该关键不能够只对单独的列使用，如

```sql
SELECT DISTINCT vend_id, prod_price FROM products;
```

则表示 vend_id 和 prod_price 都不相同时，才会被放入到结果集中

## limit 关键字

limit 关键字用于设置结果集中的行数, 语法：`LIMIT <offset>, <count>`, 表示从 offset 开始，选出 count 行。如果 offset 省略，则表示从第一行开始，选则 count 行。

> 注意：offset 从 0 开始

```
SELECT vend_id, prod_price FROM products LIMIT 5, 4;
```

表示从第 6 行开始，选择 4 行，即 6，7，8, 9 行被放入到结果集中

# and 和 or 逻辑运算符

在 Sql 中 and 运算符的优先级要比 or 的优先级高。例如：

```sql
SELECT prod_name, prod_price
FROM products
WHERE vend_id = 1002 OR vend_id = 1003 and prod_price >= 10;
```

这条语句与下面的这条语句等价

```sql
SELECT prod_name, prod_price
FROM products
WHERE vend_id = 1002 OR (vend_id = 1003 and prod_price >= 10);
```

即 vend_id = 1003 且 prod_price >= 10 的产品或者 vend_id = 1002 的产品才会被选出来

# IN 与 OR 的比较

- 在使用长的合法选项清单时，IN 操作符的语法更清楚且更直观。
- 在使用 IN 时，计算的次序更容易管理（因为使用的操作符更少）。
- **IN 操作符一般比 OR 操作符清单执行更快**。
- IN 的最大优点是可以包含其他 SELECT 语句，使得能够更动态地建立 WHERE 子句。

# 通配符

| 通配符 | 描述                                            |
| ------ | ----------------------------------------------- |
| %      | 表示任意字符出现任意次, 该通配符不能够匹配 NULL |
| _      | 下划线用于匹配任意的单个字符                    |

## 使用通配符的建议

- 不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。

- 在确实需要使用通配符时，除非绝对有必要，否则不要把它们用在搜索模式的开始处。**把通配符置于搜索模式的开始处，搜索起来是最慢的**。
- 仔细注意通配符的位置。如果放错地方，可能不会返回想要的数

# 正则表达式

在 sql 中使用正则表达式需要使用 REGEXP 关键字

## REGEXP 和 LIKE 的区别

LIKE 是将单元格中的整个内容和 LIKE 的表达式相比，但是 REGEXP 则是对列中的内容逐个匹配，例如：

有一个单元格的内容为 aaa10000, 则 `LIKE '10000'` 则不能够匹配这个单元格的内容，但是 `REGEXP '10000'` 可以匹配这个单元格的内容

LIKE 匹配整个列。如果被匹配的文本是值的一部分，LIKE 会匹配失败，相应的行也不被返回（除非使用通配符）。而 REGEXP 在列值内进行匹配，如果被匹配的文本在列值中出现，REGEXP 会匹配成功，相应的行将被返回。

> Mysql 中正则表达式匹配不区分大小系，如果需要区分大小写，需要使用 BINARY 关键字，如 WHERE prod_name REGEXP BINARY 'JetPack .000'

## 转义字符

在 Mysql 正则表达式中使用 `\\` 来匹配特殊字符，例如要匹配 `.` 字符，需要使用 `\\.` 才能够正确的进行匹配，为了匹配 `\` 则需要使用 `\\\`

> 多数正则表达式实现使用单个反斜杠转义特殊字符，以便能使用这些字符本身。但 MySQL 要求两个反斜杠（MySQL 自己解释一个，正则表达式库解释另一个）

## 匹配字符类

| 字符类     | 描述                                              |
| ---------- | ------------------------------------------------- |
| [:alnum:]  | 任意字母和数字（同[a-zA-Z0-9]）                   |
| [:alpha:]  | 任意字符（同[a-zA-Z]）                            |
| [:blank:]  | 空格和制表（同[\\t]）                             |
| [:cntrl:]  | ASCII 控制字符（ASCII 0到31和127）                |
| [:digit:]  | 任意数字（同[0-9]）                               |
| [:graph:]  | 与[:print:]相同，但不包括空格                     |
| [:lower:]  | 任意小写字母（同[a-z]）                           |
| [:print:]  | 任意可打印字符                                    |
| [:punct:]  | 既不在[:alnum:]又不在[:cntrl:]中的任意字符        |
| [:space:]  | 包括空格在内的任意空白字符（同[\\f\\n\\r\\t\\v]） |
| [:upper:]  | 任意大写字母（同[A-Z]）                           |
| [:xdigit:] | 任意十六进制数字（同[a-fA-F0-9]                   |

使用示例

```sql
SELECT prod_name
FROM products
WHERE prod_name REGEXP '[[:digit:]]{4}'
```

## 定位元字符

| 元字符  | 描述       |
| ------- | ---------- |
| ^       | 文本的开头 |
| $       | 文本的结尾 |
| [[:<:]] | 单词的开始 |
| [[:>:]] | 单词的结尾 |

> 可以在不适用数据库表的情况下用 SELECT 语句来测试正则表达式，REGEXP 检查总是返回 0(没有匹配)或 1(匹配)。可以用带文字串的 REGEXP 来测试表达式，并试验它们。语法：`select 'hello' regexp '[[:digit:]]'`

# 常用的函数

## 字符串处理函数

| 函数              | 描述                                          |
| ----------------- | --------------------------------------------- |
| concat(object...) | 拼接字符串,可以传递任意多个参数和列值进行拼接 |
| rtrim()           | 删除字符串右边的空格                          |
| ltrim()           | 删除字符串左边的空格                          |
| trim()            | 删除字符串两边的空格                          |
|                   |                                               |
| upper()           | 转换成大写                                    |
| left()            | 返回串左边的字符                              |
| length()          | 返回串的长度                                  |
| locate()          | 找出串的一个字窜                              |
| lower()           | 转换成小写字符                                |
| right()           | 返回串右边的字符                              |
| soundex()         | 返回字串的 soundex 值                         |
| substring()       | 返回字符串的子串                              |

## 日期时间处理函数

| 函数          | 描述                             |
| ------------- | -------------------------------- |
| now()         | 返回当前的日期和时间             |
| addDate()     | 增加日期                         |
| addTime()     | 增加时间                         |
| curDate()     | 返回当前的日期                   |
| curTime()     | 返回当前的时间                   |
| Date()        | 返回日期时间的日期部分           |
| DateDiff()    | 计算两个日期之差                 |
| date_add()    | 高度灵活的日期运算函数           |
| data_format() | 返回一个格式化之后的日期或时间串 |
| day()         | 返回一个日期的天数部分           |
| dayOfWeek()   | 返回日期对应的星期               |
| hour()        | 返回时间的小时部分               |
| minute()      | 返回时间的分钟部分               |
| month()       | 返回日期的月份部分               |
| second()      | 返回时间的秒部分                 |
| time()        | 返回一个日期时间的时间部分       |
| year()        | 返回一个日期的年份部分           |

> 无论你什么时候指定一个日期，不管是插入或更新表值还是用 WHERE 子句进行过滤，日期必须为格式 yyyy-mm-dd

## 数值处理函数

| 函数   | 说明       |
| ------ | ---------- |
| abs()  | 绝对值     |
| cos()  | 余弦       |
| exp()  | 返回指数值 |
| mod()  | 取余       |
| pi()   | 返回圆周率 |
| rand() | 返回随机数 |
| sin()  | 返回正弦   |
| sqrt() | 返回平方根 |
| tan()  | 返回正切   |

## 聚集函数

| 函数    | 描述                                                         |
| ------- | ------------------------------------------------------------ |
| avg()   | 返回某列的平均值,忽略 NULL 值                                |
| count() | 返回某列的行数, count(*) 则包括值为 NULL 行，count(colName) 则不包括值为 NULL 的行 |
| max()   | 返回某列的最大值                                             |
| min()   | 返回某列的最小值                                             |
| sum()   | 返回某列的和                                                 |

# 分组 Group By

Group By 相关规定：

- GROUP BY 子句可以包含任意数目的列。这使得能对分组进行嵌套，为数据分组提供更细致的控制。
- 如果在 GROUP BY 子句中嵌套了分组，数据将在最后规定的分组上进行汇总。换句话说，在建立分组时，指定的所有列都一起计算（所以不能从个别的列取回数据）。
- GROUP BY子句中列出的每个列都必须是检索列或有效的表达式（但不能是聚集函数）。如果在 SELECT 中使用表达式，则必须在
  GROUP BY 子句中指定相同的表达式。不能使用别名。
- **除聚集计算语句外，SELECT 语句中的每个列都必须在 GROUP BY 子句中给出。**
- 如果分组列中具有 NULL 值，则 NULL 将作为一个分组返回。如果列中有多行 NULL 值，它们将分为一组。
- GROUP BY子 句必须出现在 WHERE子 句之后，ORDER BY 子句之前。

# where 和 having

- where 和 having 的区别就是 where 过滤的是行，having 过滤的是分组
- WHERE 在数据分组前进行过滤，HAVING 在数据分组后进行过滤
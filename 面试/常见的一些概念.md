## 什么是 ASM

ASM 是一个 Java 字节码操控框架。它能被用来动态生成类或者增强既有类的功能。ASM 可以直接产生二进制 class 文件，也可以在类被加载入 Java 虚拟机之前动态改变类行为。Java class 被存储在严格格式定义的 .class 文件里，这些类文件拥有足够的元数据来解析类中的所有元素：类名称、方法、属性以及 Java 字节码（指令）。**ASM 从类文件中读入信息后，能够改变类行为，分析类信息，甚至能够根据用户要求生成新类。**

ASM 能够通过改造既有类，直接生成需要的代码。**增强的代码是硬编码在新生成的类文件内部的，没有反射带来性能上的付出**。同时，ASM 与 Proxy 编程不同，不需要为增强代码而新定义一个接口，生成的代码可以覆盖原来的类，或者是原始类的子类。**它是一个普通的 Java 类而不是 proxy 类**，甚至可以在应用程序的类框架中拥有自己的位置，派生自己的子类。

相比于其他流行的 Java 字节码操纵工具，ASM 更小更快。ASM 具有类似于 BCEL 或者 SERP 的功能，而只有 33k 大小，而后者分别有 350k 和 150k。同时，同样类转换的负载，如果 ASM 是 60% 的话，BCEL 需要 700%，而 SERP 需要 1100% 或者更多。

## 什么是 RPC

RPC 称远程过程调用（Remote Procedure Call），用于解决分布式系统中服务之间的调用问题。 通俗地讲，就是开发者能够像调用本地方法一样调用远程的服务。 所以，RPC的作用主要体现在这两个方面：

- 屏蔽远程调用跟本地调用的区别，让我们感觉就是调用项目内的方法；
- 隐藏底层网络通信的复杂性，让我们更专注于业务逻辑。

### RPC 框架基本架构

下面我们通过一幅图来说说 RPC 框架的基本架构 ![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c3233fd8e9914fdcab290794e7a0f0c8~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp) RPC 框架包含三个最重要的组件，分别是客户端、服务端和注册中心。在一次 RPC 调用流程中，这三个组件是这样交互的：

- 服务端在启动后，会将它提供的服务列表发布到注册中心，客户端向注册中心订阅服务地址；
- 客户端会通过本地代理模块 Proxy 调用服务端，Proxy 模块负责将方法、参数等数据转化成网络字节流；
- 客户端从服务列表中选取其中一个的服务地址，并将数据通过网络发送给服务端；
- 服务端接收到数据后进行解码，得到请求信息；
- 服务端根据解码后的请求信息调用对应的服务，然后将调用结果返回给客户端。

### RPC 框架通信流程以及涉及到的角色

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7c83315d4d247a1aed076e481fe0e11~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp) 
从上面这张图中，可以看见 RPC 框架一般有这些组件：服务治理(注册发现)、负载均衡、容错、序列化/反序列化、编解码、网络传输、线程池、动态代理等角色，当然有的RPC框架还会有连接池、日志、安全等角色。